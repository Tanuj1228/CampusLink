<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenant Dashboard - WebSocket & GraphQL Test</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .job-card { border: 1px solid #ccc; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        #notifications { color: red; font-weight: bold; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h2>Tenant (Student) Dashboard</h2>
    <div id="notifications"></div>
    
    <button onclick="fetchJobs()">Load Jobs via GraphQL</button>
    <div id="job-list" style="margin-top: 20px;"></div>

    <script>
        const socket = io();
        const notificationDiv = document.getElementById('notifications');
        const jobListDiv = document.getElementById('job-list');

        socket.on('new_job_alert', (job) => {
            notificationDiv.innerText = `ðŸ”” New Job Posted: ${job.title} (${job.category})!`;
            setTimeout(() => { notificationDiv.innerText = ''; }, 5000);
            fetchJobs(); 
        });

        async function fetchJobs() {
            const query = `
                query {
                    getJobs {
                        id
                        title
                        description
                        category
                        jd_link
                    }
                }
            `;
            const response = await fetch('/graphql', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query })
            });
            const result = await response.json();
            
            jobListDiv.innerHTML = '';
            result.data.getJobs.forEach(job => {
                jobListDiv.innerHTML += `
                    <div class="job-card">
                        <h3>${job.title}</h3>
                        <p><strong>Category:</strong> ${job.category}</p>
                        <p>${job.description}</p>
                        <a href="${job.jd_link}" target="_blank">Download JD (Drive Link)</a>
                        <br><br>
                        <button>Apply Now</button>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>