<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Reviews | Job Portal</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="display: flex; flex-direction: column; min-height: 100vh;">
    <nav class="navbar">
        <a href="index.html" class="logo">SupersetClone</a>
        <div class="nav-links">
            <button class="btn-outline" onclick="window.location.href='/company.html'">Back to Dashboard</button>
            <button class="btn-primary" onclick="logout()" style="background: #dc3545;">Logout</button>
        </div>
    </nav>
    
    <div class="container" style="flex-grow: 1;">
        <h2 style="border-bottom: 2px solid #dee2e6; padding-bottom: 10px;">What Students Are Saying</h2>
        <div id="reviews-list" style="margin-top: 20px; display: grid; gap: 15px;"></div>
    </div>

    <script>
        const companyId = localStorage.getItem('companyId');
        if (!companyId) window.location.href = '/login.html';

        function logout() {
            localStorage.clear();
            window.location.href = '/login.html';
        }

        async function fetchReviews() {
            const query = `
                query {
                    getCompanyReviews(companyId: "${companyId}") {
                        rating
                        comment
                        student { name }
                    }
                }
            `;
            const response = await fetch('/graphql', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query })
            });
            const result = await response.json();
            
            const reviewsListDiv = document.getElementById('reviews-list');
            reviewsListDiv.innerHTML = '';
            
            if (!result.data.getCompanyReviews || result.data.getCompanyReviews.length === 0) {
                reviewsListDiv.innerHTML = '<p style="color:#6c757d;">No reviews yet.</p>';
                return;
            }

            result.data.getCompanyReviews.forEach(review => {
                const stars = '‚≠ê'.repeat(review.rating);
                reviewsListDiv.innerHTML += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <h4 style="margin: 0 0 10px 0;">${review.student.name} <span style="font-weight: normal; margin-left: 10px;">${stars}</span></h4>
                        <p style="margin: 0; color: #495057;">"${review.comment}"</p>
                    </div>
                `;
            });
        }

        fetchReviews();
    </script>
</body>
</html>